#!/bin/bash

# most of this is shamelessly stolen from
# /usr/bin/hadoop
# /usr/lib/hadoop/bin/hadoop

# Autodetect JAVA_HOME if not defined
if [ -e /usr/libexec/bigtop-detect-javahome ]; then
. /usr/libexec/bigtop-detect-javahome
elif [ -e /usr/lib/bigtop-utils/bigtop-detect-javahome ]; then
. /usr/lib/bigtop-utils/bigtop-detect-javahome
fi

# hack to include our jar in CLASSPATH
HADOOP_CLASSPATH=@libdir@/hdfs-xrootd-healer/hdfs-xrootd-healer.jar

export HADOOP_LIBEXEC_DIR=@HADOOP_LIBEXEC_DIR@
. $HADOOP_LIBEXEC_DIR/hadoop-config.sh

export HDFS_XRD_HEALER_CONF=@sysconfdir@/hdfs-xrootd-healer/hdfs-xrootd-healer.cfg

# Always respect HADOOP_OPTS and HADOOP_CLIENT_OPTS
HADOOP_OPTS="$HADOOP_OPTS $HADOOP_CLIENT_OPTS"

# not sure what it is for but real hadoop client sets it
#make sure security appender is turned off
HADOOP_OPTS="$HADOOP_OPTS -Dhadoop.security.logger=${HADOOP_SECURITY_LOGGER:-INFO,NullAppender}"

export CLASSPATH=$CLASSPATH

exec "$JAVA" $JAVA_HEAP_MAX $HADOOP_OPTS edu.ucsd.t2.hdfs.xrootd.healer.BlockHealer "$@"
